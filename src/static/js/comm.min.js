function show_wait(a){function c(){$("#modal-wait").modal("hide")}function b(d){$("#errormsg-wait").html(d);show($("#errormsg-wait"))}hide($("#errormsg-wait"));$("#modal-wait").modal();a(c,b)}function my_show_search(){$("#searchword").val("");$("#modal-search").modal();$("#searchword").trigger("focus")}function manual_add(){$("#modal-add").modal();$("#url-add").trigger("focus")}function try_to_get_title(){var b=$('#form-add > input[name="title"]').val();if(b){return}var a=$("#url-add").val();$.ajax({url:"/0.1/gettitle/",type:"POST",data:{url:a},dataType:"json",success:function(d){if(d.ok){var c=$('#form-add > input[name="title"]').val();if(c){return}$('#form-add > input[name="title"]').val(d.title)}},timeout:5000})}function my_confirm_add(){addbookmark_i($("#form-add"),function(){showmessage($("#successmsg-add"),"添加更新");setTimeout(reload,800)},function(a){showmessage($("#errormsg-add"),a)})}function my_show_import(){$("#modal-import").modal()}function loadbookmark(d,c,a){function b(e,e,f){a(f)}$.ajax({url:"/0.1/get/",type:"POST",data:{bookmarkid:d},dataType:"json",success:c,error:b,timeout:10000})}function my_show_edit(a){show_wait(function(c,b){loadbookmark(a,function(d){if(d.noauth){return home()}if(d.error){return b(d.error)}if(d.ok){c();my_show_edit_i(d)}},b)})}function my_show_edit_i(a){$("#form-edit > input[name=bookmarkid]").val(a.id);$("#form-edit > input[name=title]").val(a.title);$("#form-edit > select").val(a.cid);$("#form-edit > input[name=tag]").val(a.tag);$("#form-edit > textarea").html(a.notes);$("#form-edit > textarea").attr("rows",3);hide($("#successmsg-edit"));hide($("#errormsg-edit"));show($("#form-edit"));$("#modal-edit").modal()}function my_confirm_edit(){updatebookmark_i($("#form-edit"),function(){showmessage($("#successmsg-edit"),"成功更新");setTimeout(reload,800)},function(a){showmessage($("#errormsg-edit"),a)})}function k_confirm_move(){function a(){$("#modal-move").modal("hide")}movebookmark_i($("#form-move"),function(){showmessage($("#successmsg-move"),"成功更新");setTimeout(a,800)},function(b){showmessage($("#errormsg-move"),b)})}function my_confirm_move(){movebookmark_i($("#form-move"),function(){showmessage($("#successmsg-move"),"成功更新");setTimeout(reload,800)},function(a){showmessage($("#errormsg-move"),a)})}function my_show_move(){var a=[];$.each($("tr.op td.bulk i"),function(b,c){if($(c).hasClass("icon-check")){a.push($(c).attr("bid"))}});if(a.length<1){return}$("#bookmarkid-move").val(a.join(","));$("#modal-move").modal()}function my_show_del(a){show($("#btns-del"));$("#message-del").text($("#title_"+a).html());show($("#msg-del"));$("#bookmarkid-del").val(""+a);hide($("#successmsg-del"));hide($("#errormsg-del"));$("#modal-del").modal()}function my_show_bulkdel(){var a=[];$.each($("tr.op td.bulk i"),function(b,c){if($(c).hasClass("icon-check")){a.push($(c).attr("bid"))}});if(a.length<1){return}show($("#btns-bulkdel"));$("#message-bulkdel").text("已选中"+a.length+"条记录");show($("#msg-bulkdel"));$("#bookmarkid-bulkdel").val(a.join(","));hide($("#successmsg-bulkdel"));hide($("#errormsg-bulkdel"));$("#modal-bulkdel").modal()}function my_confirm_del(){delbookmarkconfirm_i("del",reload)}function my_confirm_bulkdel(){delbookmarkconfirm_i("bulkdel",reload)}function k_confirm_del(){delbookmarkconfirm_i("del",function(){hide($("#tr_"+$("#bookmarkid-del").val()));var a=parseInt($("#count").text())-1;if(a>0){$("#count").text(a)}})}function k_confirm_bulkdel(){delbookmarkconfirm_i("bulkdel",function(){var c=$("#bookmarkid-bulkdel").val().split(",");for(var b=0;b<c.length;b++){hide($("#tr_"+c[b]))}var a=parseInt($("#count").text())-1;if(a>0){$("#count").text(a)}if(a<1){$("#count").text(0)}})}function delbookmarkconfirm_i(b,c){function a(){$("#modal-"+b).modal("hide")}delbookmark_i($("#bookmarkid-"+b).val(),function(){hide($("#msg-"+b));hide($("#btns-"+b));showmessage($("#successmsg-"+b),"成功删除");setTimeout(function(){a();if(c){c()}},800)},function(d){showmessage($("#errormsg-"+b),d)})}function movebookmark_i(d,c,b){function a(f,f,g){if(b){b(g)}}function e(f){if(f.noauth){return home()}if(f.error&&b){return b(f.error)}if(f.ok&&c){c()}}$.ajax({url:"/0.1/move/",type:"POST",data:d.serialize(),dataType:"json",success:e,error:a,timeout:10000})}function delbookmark_i(a,d,c){function b(f,f,g){if(c){c(g)}}function e(f){if(f.noauth){return home()}if(f.error&&c){return c(f.error)}if(f.ok&&d){d()}}$.ajax({url:"/0.1/delete/",type:"POST",data:$.param({bookmarkid:a}),dataType:"json",success:e,error:b,timeout:10000})}function updatebookmark_i(d,c,b){function a(f,f,g){if(b){b(g)}}function e(f){if(f.noauth){return home()}if(f.error&&b){return b(f.error)}if(f.ok&&c){c()}}$.ajax({url:"/0.1/update/",type:"POST",data:d.serialize(),dataType:"json",success:e,error:a,timeout:10000})}function addbookmark_i(d,c,b){function a(f,f,g){if(b){b(g)}}function e(f){if(f.noauth){return home()}if(f.error&&b){return b(f.error)}if(f.ok&&c){c()}}$.ajax({url:"/0.1/manualtie/",type:"POST",data:d.serialize(),dataType:"json",success:e,error:a,timeout:10000})}function updatepassword(){function a(c,c,d){$.notify(""+d,{position:"top center",className:"error"})}function b(c){if(c.noauth){return home()}if(c.error){$.notify(c.error,{position:"top center",className:"error"})}if(c.ok){$.notify(c.ok,{position:"top center",className:"success"})}}$.ajax({url:"/0.1/password/",type:"POST",data:$("#passwordform").serialize(),dataType:"json",success:b,error:a,timeout:10000});return false}function updatecopycat(){function a(c,c,d){$.notify(""+d,{position:"top center",className:"error"})}function b(c){if(c.noauth){return home()}if(c.error){$.notify(c.error,{position:"top center",className:"error"})}if(c.ok){$.notify(c.ok,{position:"top center",className:"success"})}}$.ajax({url:"/0.1/copycat/",type:"POST",data:$("#copycatform").serialize(),dataType:"json",success:b,error:a,timeout:10000});return false}function my_show_newcat(){hide($("#msg-newcat"));$("#modal-newcat").modal()}function my_show_delcat(){hide($("#msg-delcat"));$("#modal-delcat").modal()}function my_confirm_newcat(){createcategory_i($("#newcat-title").val(),function(){showmessage($("#successmsg-newcat"),"新的收藏夹已创建");setTimeout(reload,1000)},function(a){showmessage($("#msg-newcat"),a)})}function my_confirm_delcat(){delcategory_i($("#delcat-title").val(),function(){showmessage($("#msg-delcat"),"成功删除了此收藏夹");setTimeout(reload,1000)},function(a){showmessage($("#msg-delcat"),a)})}function createcategory_i(d,e,a){function c(f){if(f.noauth){return home()}if(f.error&&a){return a(f.error)}if(e){e()}}function b(f,f,g){if(a){a(g)}}$.ajax({url:"/0.1/newcat/",type:"POST",data:{title:d},dataType:"json",success:c,error:b,timeout:10000});return false}function delcategory_i(b,d,a){function c(e){if(e.noauth){return home()}if(e.error&&a){return a(e.error)}if(d){d()}}$.ajax({url:"/0.1/delcat/",type:"POST",data:{category:b},dataType:"json",success:c,error:function(e,e,f){if(a){a(f)}},timeout:10000});return false}function hideoneheart(a){hide($("#heartico_"+a));$("#heart_"+a).removeClass("icon-heart-empty").addClass("icon-heart")}function showoneheart(a){show($("#heartico_"+a));$("#heart_"+a).removeClass("icon-heart").addClass("icon-heart-empty")}function changeoneheart(a){var b=$("#heartico_"+a);if(b.hasClass("hide")){showoneheart(a)}else{hideoneheart(a)}}function cancelheart(a){heart_i([a],0,function(){hide($("#tr_"+a));$("#count").html(parseInt($("#count").text())-1)})}function bulkheart(){if(!getStatus("bulk")){return}var e=[];$.each($("tr.op td.bulk i"),function(b,f){if($(f).hasClass("icon-check")){e.push($(f).attr("bid"))}});if(e.length<1){return}var a=$("#bulkheart > i");function d(f){for(var b=0;b<f.length;b++){showoneheart(f[b])}a.attr("title","取消喜爱");a.removeClass("icon-heart").addClass("icon-heart-empty")}function c(f){for(var b=0;b<f.length;b++){hideoneheart(f[b])}a.attr("title","加喜爱");a.removeClass("icon-heart-empty").addClass("icon-heart")}if(a.hasClass("icon-heart")){heart_i(e,1,d)}else{heart_i(e,0,c)}}function heart(b){var c=$("#heartico_"+b);var a=0;if(c.hasClass("hide")){a=1}heart_i([b],a,function(e){for(var d=0;d<e.length;d++){changeoneheart(e[d])}})}function heart_i(b,a,d){function c(e){if(e.noauth){return home()}if(e.ok&&d){d(b)}}$.ajax({url:"/0.1/heart/",type:"POST",data:$.param({bookmarkids:b.join(","),flag:""+a}),dataType:"json",success:c,timeout:8000});return false}function snapshot(a){var b=$("#ss_"+a);if(b.hasClass("icon-refresh")){return}snapshot_i(a,function(c){var d=$("#ss_"+c);var e=$("#ss_"+c).parent();e.attr("title","正在快照中...");d.removeClass("icon-camera").addClass("icon-refresh")})}function snapshot_i(a,c){function b(d){if(d.noauth){return home()}if(d.ok&&c){c(a)}if(d.error){$.notify(d.error,{position:"top center",autoHideDelay:2000})}}$.ajax({url:"/0.1/snapshot/",type:"POST",data:{bookmarkid:a},dataType:"json",success:b,timeout:8000});return false}function showmessage(a,b){a.text(b);a.removeClass("hide")}function reload(){window.location.reload()}function home(){window.location.href="/"}function show(a){a.removeClass("hide")}function hide(a){a.addClass("hide")}function Turnner(b,a){this.func=[b,a]}Turnner.prototype.turn=function(){func=this.func.shift();this.func.push(func);func()};STATUS={};function updateStatus(a,b){STATUS[a]=b}function getStatus(a){return STATUS[a]}function ahead_matcher(c){var a=this.query.split(/,|，/);var b=a[a.length-1];if(!b){return false}return ~c.toLowerCase().indexOf(b.toLowerCase())}function ahead_sorter(e){var a=this.query.split(/,|，/);var c=a[a.length-1];if(!c){return[]}c=c.toLowerCase();var f=[],d=[],b=[];while(item=e.shift()){if(!item.toLowerCase().indexOf(c)){f.push(item)}else{if(~item.indexOf(c)){d.push(item)}else{b.push(item)}}}return f.concat(d,b)}function ahead_updater(b){var a=this.query.split(/,|，/);a=a.slice(0,-1);a.push(b);return a.join(",")+","};